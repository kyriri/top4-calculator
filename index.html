<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8"/>
    <title>Calculator</title>
    <style>
      html {
        font-family: Avenir, 'Lucida Sans', 'Lucida Sans Unicode', Geneva, Verdana, sans-serif;
        font-size: 10px;
        color: black;
      }
      .content {
        width: 52vh;
        margin: 0 auto;
      }
      main {
        display: grid;
        grid-template-columns: repeat(4, 1fr);
        grid-template-rows: auto;
        column-gap: 1vh;
        row-gap: 1vh;
        grid-template-areas:
        'display display display display'
        'clear   clear   mult    divi'
        'k7      k8      k9      minus'
        'k4      k5      k6      sum'
        'k1      k2      k3      equals'
        'k0      k0      dot     equals';
      }
      .display { 
        color: white;
        background-color: #8f6245;
        height: 8vh;
        font-family: monospace;
        font-size: 6.5vh;
        font-style: italic;
        text-align: right;
        grid-area: display; 
        border-radius: .5vh;
        padding: 2vh;
      }
      .all-keys {
        background-color: #d0abb5;
        height: 8vh;
        font-size: 3vh;
        border-radius: .5vh;
        padding: 2vh;
      }
      .all-keys:hover {
        box-shadow: 0 0 .8vh 0.4vh #5e6985;
      }
      .function-key {
        background-color: #eacfcb;
      }
      #clear { grid-area: clear; }
      #equals { 
        height: auto;
        grid-area: equals; 
      }
      #multi { grid-area: multi; }
      #divi { grid-area: divi; }
      #minus { grid-area: minus; }
      #sum { grid-area: sum; }
      #dot { 
        grid-area: dot;
        font-weight: 500;
      }
      #k0 { grid-area: k0; }
      #k1 { grid-area: k1; }
      #k2 { grid-area: k2; }
      #k3 { grid-area: k3; }
      #k4 { grid-area: k4; }
      #k5 { grid-area: k5; }
      #k6 { grid-area: k6; }
      #k7 { grid-area: k7; }
      #k8 { grid-area: k8; }
      #k9 { grid-area: k9; }
      footer {
        font-size: 1.6vh;
        color: #5e6985;
        text-align: cequals;
        margin-top: 1.6vh;
      }
      a, a:active, a:visited {
        color: #5e6985;
        text-decoration: none;
      }
      a:hover {
          color: black;
          text-shadow: 0 0 0.8vh #d0abb5;
      }
    </style>
  </head>
  <body>
    <div class='content'>
      <header></header>
      <main>
        <div class='display'>0</div>
        <div id='clear' class='function-key all-keys'>clear</div>
        <div id='mult' class='function-key all-keys'>×</div>
        <div id='divi' class='function-key all-keys'>÷</div>
        <div id='minus' class='function-key all-keys'>−</div>
        <div id='sum' class='function-key all-keys'>+</div>
        <div id='k0' class='all-keys'>0</div>
        <div id='k1' class='all-keys'>1</div>
        <div id='k2' class='all-keys'>2</div>
        <div id='k3' class='all-keys'>3</div>
        <div id='k4' class='all-keys'>4</div>
        <div id='k5' class='all-keys'>5</div>
        <div id='k6' class='all-keys'>6</div>
        <div id='k7' class='all-keys'>7</div>
        <div id='k8' class='all-keys'>8</div>
        <div id='k9' class='all-keys'>9</div>
        <div id='dot' class='all-keys'>.</div>
        <div id='equals' class='function-key all-keys'>equals</div>
      </main>
      <footer>
        <a href='https://github.com/kyriri' target='_blank'>kyriri</a> 
          @ 2020 quarentine
        <BR>projects: 
          <a href='https://kyriri.github.io/top3-etch-a-sketch/'>previous</a>
          | 
          <a href=''>next</a>
      </footer>
    </div>
  </body>
  <script>
    const display = document.getElementsByClassName('display')[0];
    let memory = [{
      name: 'number1',
      type: 'num',
      value: null,
    },{
      name: 'function1',
      type: 'fn',
      value: null,
    },{      
      name: 'number2',
      type: 'num',
      value: null,
    }];
    let usher = 0;

    // the function below reads an event and returns an object
    // with value and its type (function or number).
    function identifyInput(e) {
      if (e.target.id) {
        input = e.target.id === 'dot' ? '.' : e.target.id ;
      } else {
        input = e.key;
        switch (true) {
          case (e.code == 'Space'):
            return;
          case (!isNaN(input*1)):
            break;
          case (input == '.' || input ==','):
            input = '.';
            break;
          case (input == '+'):
            input = 'sum';
            break;
          case (input == '-'):
            input = 'minus';
            break;
          case (input == '*'):
            input = 'mult';
            break;
          case (input == '/'):
            input = 'divi';
            break;
          case (input == 'Backspace' || input == 'Delete'):
            input = 'clear';
            break;
          case (input == 'Enter' || input == '='):
            input = 'equals';
            break;
          default:
            return;
        }
      }
      // below, if both conditions are inside the same regex, it might 
      // return an empty array [''], and that fools the Boolean test
      const numerical = input.match(/[0-9]/) || input.match(/\./);
      return numerical ? { 
          type: 'num',
          value: numerical[0], 
        } : {
          type: 'fn',
          value: input,
        };
    }
    function placeInput(input) {
      if (!input) return;
      if (input.value == 'clear') { clear(); return; }

      if (usher % 2 === 0) {       // usher points to number position...
        if (input.type == 'num') { // ...and input is num
          if (input.value === '.' && memory[usher].value.match(/\./)) return;
          if (memory[usher].value === null) memory[usher].value = input.value;
          else memory[usher].value += input.value;
        } 
        if (input.type == 'fn') {  // ...but input is fn
          if (usher === 0) {
            memory[1].value = input.value;
            usher += 1;
          } 
          if (usher === 2) {
            if (memory[2].value === null) memory[1].value = input.value;
            else {
              memory[0].value = calculate(memory[0].value, memory[1].value, memory[2].value);
              memory[1].value = input.value;
              memory[2].value = null;
              usher -= 1;
            }
          }
        }
      } else { // usher points to function position (that is, 1)
        if (input.type == 'num') {
          if (memory[1].value == 'equals') {
            memory[0].value = input.value;
            memory[1].value = null;
            usher -= 1;
          } else {
            memory[2].value = input.value;
            usher += 1;
          }
        } else {
          memory[1].value = input.value;
        }
      }
      updateDisplay();
    }
    function updateDisplay() {
      display.innerHTML = memory.reduce( (acc, item) => { 
        let char;
        if (item.value === null) char = '';
        else {
          switch (item.value) {
            case 'minus':
              char = '-';
              break;
            case 'sum':
              char = '+';
              break;
            case 'mult':
              char = '×';
              break;      
            case 'divi':
              char = '÷';
              break;   
            case 'equals':
              char = '';
              break;   
            default:
              char = item.value;
          }
        } 
        return acc + char;
      }, '');
    }
    function clear() {
      memory.map(item => item.value = null);
      usher = 0;
      updateDisplay()
    }
    function calculate(num1 = 0, fn, num2 = 0) {
      let result;
      num1 = +num1;
      num2 = +num2;
      switch (fn) {
        case 'sum':
          result = num1 + num2;
          break;
        case 'minus':
          result = num1 - num2;
          break;
        case 'mult':
          result = num1 * num2;
          break;
        case 'divi':
          result = num1 / num2;
          if (isNaN(result)) return 'Error'
          if (result === Infinity) return '∞'
        }
      return String(result);
    }

    function test(e) {
      placeInput( identifyInput(e) );
      console.table(memory);
    }
    window.addEventListener('click', test);
    window.addEventListener('keydown', test);
  </script>
</html>