<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8"/>
    <title>Calculator</title>
    <style>
      html {
        font-family: Avenir, 'Lucida Sans', 'Lucida Sans Unicode', Geneva, Verdana, sans-serif;
        font-size: 10px;
        color: black;
      }
      .content {
        width: 52vh;
        margin: 0 auto;
      }
      main {
        display: grid;
        grid-template-columns: repeat(4, 1fr);
        grid-template-rows: auto;
        column-gap: 1vh;
        row-gap: 1vh;
        grid-template-areas:
        'display display display display'
        'clear   clear   mult    divi'
        'k7      k8      k9      minus'
        'k4      k5      k6      sum'
        'k1      k2      k3      enter'
        'k0      k0      comma   enter';
      }
      .display { 
        color: white;
        background-color: #8f6245;
        height: 8vh;
        font-family: monospace;
        font-size: 6.5vh;
        font-style: italic;
        text-align: right;
        grid-area: display; 
        border-radius: .5vh;
        padding: 2vh;
      }
      .all-keys {
        background-color: #d0abb5;
        height: 8vh;
        font-size: 3vh;
        border-radius: .5vh;
        padding: 2vh;
      }
      .function-key {
        background-color: #eacfcb;
      }
      #clear { grid-area: clear; }
      #enter { 
        height: auto;
        grid-area: enter; 
      }
      #multi { grid-area: multi; }
      #divi { grid-area: divi; }
      #minus { grid-area: minus; }
      #sum { grid-area: sum; }
      .comma { grid-area: comma; }
      .k0 { grid-area: k0; }
      .k1 { grid-area: k1; }
      .k2 { grid-area: k2; }
      .k3 { grid-area: k3; }
      .k4 { grid-area: k4; }
      .k5 { grid-area: k5; }
      .k6 { grid-area: k6; }
      .k7 { grid-area: k7; }
      .k8 { grid-area: k8; }
      .k9 { grid-area: k9; }
      footer {
        font-size: 1.6vh;
        color: #5e6985;
        text-align: center;
        margin-top: 1.6vh;
      }
      a, a:active, a:visited {
        color: #5e6985;
        text-decoration: none;
      }
      a:hover {
          color: black;
          text-shadow: 0 0 0.8vh #d0abb5;
      }
    </style>
  </head>
  <body>
    <div class='content'>
      <header></header>
      <main>
        <div class='display'>0</div>
        <div id='clear' class='function-key all-keys'>clear</div>
        <div id='mult' class='function-key all-keys'>×</div>
        <div id='divi' class='function-key all-keys'>÷</div>
        <div id='minus' class='function-key all-keys'>−</div>
        <div id='sum' class='function-key all-keys'>+</div>
        <div class='k0 all-keys' value='0'>0</div>
        <div class='k1 all-keys' value='1'>1</div>
        <div class='k2 all-keys' value='2'>2</div>
        <div class='k3 all-keys' value='3'>3</div>
        <div class='k4 all-keys' value='4'>4</div>
        <div class='k5 all-keys' value='5'>5</div>
        <div class='k6 all-keys' value='6'>6</div>
        <div class='k7 all-keys' value='7'>7</div>
        <div class='k8 all-keys' value='8'>8</div>
        <div class='k9 all-keys' value='9'>9</div>
        <div class='comma all-keys' value='.'>'</div>
        <div id='enter' class='function-key all-keys'>enter</div>
      </main>
      <footer>
        <a href='https://github.com/kyriri' target='_blank'>kyriri</a> 
          @ 2020 quarentine
        <BR>projects: 
          <a href='https://kyriri.github.io/top3-etch-a-sketch/'>previous</a>
          | 
          <a href=''>next</a>
      </footer>
    </div>
  </body>
  <script>
    const display = document.getElementsByClassName('display')[0];

    let num1 = '';
    let num2 = '';
    let currentInput = 'num1';
    let currentInputContent = '';
    let fn = '';

    window.addEventListener('click', retriveClickInput);
    window.addEventListener('keydown', retrieveKeyboardInput);

    function updateDisplay(info = currentInputContent) {
      display.innerHTML = info;
    }

    function toggleOrCalculate() {
      if (currentInput == 'num1')  {
        num1 = currentInputContent;
        currentInputContent = '';
        currentInput = 'num2';
        
      } else {
        num2 = currentInputContent;
        currentInputContent = '';
        currentInput = 'num1';
        num1 = calculator(+num1, +num2, fn);
        updateDisplay(num1);
      }
    }
    function retriveClickInput(e) {
      if (e.target.attributes.value) {
        value = e.target.attributes.value.value;
        if (value == '.' && currentInputContent.match(/\./)) { return; }
        currentInputContent += value;
        updateDisplay();
        return;
      }
      if (e.target.id) {   
        toggleOrCalculate();
        fn = e.target.id;
        return;
      }
    }
    function retrieveKeyboardInput(e){
      value = e.key;      
      if( value == '.' || !isNaN(+value)) {
        if (value == '.' && currentInputContent.match(/\./)) { return; }
        currentInputContent += value;
        updateDisplay();
      } else {
        toggleOrCalculate();
        switch (value) {
          case '+':
            fn = 'sum';
            break;
          case '-':
            fn = 'minus';
            break;
          case '*':
            fn = 'mult';
            break;
          case '/':
            fn = 'divi';
            break;
          case ('Backspace' || 'Delete'):
            fn = 'clear';
            break;
          case 'Enter':
            fn = 'enter';
            break;
        }
      }
    }
    function calculator(num1 = 0, num2 = 0, fn) {
      switch (fn) {
        case 'sum':
          return num1 + num2;
        case 'minus':
          return num1 - num2;
        case 'mult':
          return num1 * num2;
        case 'divi':
          let result = num1 / num2;
          if (isNaN(result)) return 'Error'
          if (result === Infinity) return '∞'
          return result;
      }
    }

/*
    while input !function-key keep building number
    (after first use of comma, disable it)
    when click on function, finishes number, store fn and start next
    while input !function-key keep building number
    when click on function, evaluate, display and store result as num1
    -- unless function was enter followed by a number, in which case
       it should dismiss the result and build new num1

       for later: double role of minus key (negative and operation)
                  clear and restart keys
                  correct comma vs dot visualization
                  fallback for when number ends in comma
                  what to do when the number is bigger than the display?
*/
  </script>
</html>